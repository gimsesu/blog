---
title: ğŸ“š Elastic Stackìœ¼ë¡œ ë‚´ Appì˜ Logë¥¼ ê´€ë¦¬í•´ë³´ì(2) - Filebeatë¡œ ìˆ˜ì§‘í•˜ê³  Kibanaì—ì„œ í™•ì¸í•˜ê¸°
date: 2021-04-27
slug: "/manage-logs-with-elastic-stack-2"
description: Elastic Stackì„ ì´ìš©í•´ Appì—ì„œ ë°œìƒí•˜ëŠ” ë¡œê·¸(Log) ë°ì´í„°ë¥¼ ê´€ë¦¬í•œ ê²½í—˜ì„ ê³µìœ í•©ë‹ˆë‹¤.
tags:
  - Elastic Stack
  - Elasticsearcch
  - Kibana
  - Filebeat
  - Docker
---

## ğŸ§° ì¤€ë¹„ë¬¼

- Elasticsearch v7.x
- Kibana v7.x
- Filebeat v7.x
- Ubuntu 18.04.x LTS
- Filebeatë¥¼ ë¶€ì°©í•  ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„(Application Server)

ì•ì„œ ['Elastic Stackìœ¼ë¡œ ë‚´ Appì˜ Logë¥¼ ê´€ë¦¬í•´ë³´ì(1) - Elasticsearch, Kibanaë¥¼ Dockerë¡œ ì„¤ì¹˜í•˜ê¸°'](https://www.gimsesu.me/manage-logs-with-elastic-stack-1)ì—ì„œ Elastic Stackì„ ì´ë£¨ëŠ” ìš”ì†Œ ì¤‘ Elasticsearchì™€ Kibanaë¥¼ ì„¤ì¹˜í•´ ë³´ì•˜ë‹¤. 

ì´ë²ˆ ê¸€ì—ì„œëŠ” ë¡œê·¸(Log) ìˆ˜ì§‘ê¸°ì¸ Filebeatë¥¼ ì„¤ì¹˜í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•˜ê³ , Kibanaì—ì„œ ê·¸ ê²°ê³¼ë¬¼ì„ í™•ì¸í•˜ëŠ” ê³¼ì •ì„ ê¸°ìˆ í•œë‹¤.


## ğŸ‘¾ Filebeatê°€ ë­”ê°€ìš”?

[***beat**](https://www.elastic.co/guide/en/beats/libbeat/current/beats-reference.html)ëŠ” Elasticì—ì„œ ì œê³µí•˜ëŠ” ê²½ëŸ‰ ë°ì´í„° ì „ë‹¬ìë¥¼ ê°€ë¦¬í‚¨ë‹¤. ìˆ˜ì§‘í•˜ëŠ” ë°ì´í„°ì— ë”°ë¼ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ beatsë¥¼ ì œê³µí•œë‹¤.

ê·¸ì¤‘ì—ì„œ [Filebeat](https://www.elastic.co/guide/en/beats/filebeat/7.12/filebeat-overview.html)ëŠ” `ë¡œê·¸(Log)` ìˆ˜ì§‘ê¸°ë‹¤. ë¡œê·¸ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ê³  ì¤‘ì•™ ì§‘ì¤‘í™”í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

FilebeatëŠ” ì‚¬ìš©ìê°€ ì§€ì •í•œ ë¡œê·¸ íŒŒì¼ì„ ê°ì‹œí•œë‹¤. ê°±ì‹ ë˜ëŠ” ë¡œê·¸ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì§‘í•´ì„œ ìƒ‰ì¸í™”(ì €ì¥)ë¥¼ ìœ„í•´ Elasticsearchë‚˜ Logstashë¡œ ë³´ë‚¸ë‹¤.

## ì„¤ì¹˜

ëª¨ë‹ˆí„°ë§í•˜ë ¤ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìœ„ì¹˜í•œ ì¥ë¹„ì— ì„¤ì¹˜í•´ì•¼ í•œë‹¤. FilebeatëŠ” ìš´ì˜ í™˜ê²½ì— ë”°ë¼ [ë‹¤ì–‘í•œ ì„¤ì¹˜ ë°©ë²•](https://www.elastic.co/guide/en/beats/filebeat/7.12/filebeat-installation-configuration.html#other-installation-options)ì„ ì œê³µí•œë‹¤.

ë‚˜ëŠ” ì•ì„œ ë„ì»¤ ì´ë¯¸ì§€ë¡œ ì„¤ì¹˜í–ˆë˜ Elasticsearch, Kibanaì™€ ë‹¬ë¦¬ FilebeatëŠ” ë¡œì»¬ í™˜ê²½ì— ì„¤ì¹˜í–ˆë‹¤. (ì´ ë°©ë²•ì´ ì œì¼ ê°„ë‹¨í•´ ë³´ì˜€ë‹¤...)

ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ë‹¤ìš´ë¡œë“œ í›„ ì••ì¶•ì„ í‘¼ë‹¤. ì‹¤ì œ ë‹¤ìš´ë¡œë“œ ëª…ë ¹ì–´ëŠ” [ì—¬ê¸°](https://www.elastic.co/guide/en/beats/filebeat/7.12/filebeat-installation-configuration.html#installation)ë¥¼ ì°¸ê³ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```shell
# Linux í™˜ê²½
curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.12.0-linux-x86_64.tar.gz
tar xzvf filebeat-7.12.0-linux-x86_64.tar.gz
```

ì••ì¶•ì„ í•´ì œí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ë˜ì–´ ìˆë‹¤.

```shell
$ l filebeat-7.12.0-linux-x86_64/
LICENSE.txt  README.md  fields.yml  filebeat.reference.yml  kibana/  module/
NOTICE.txt   data/      filebeat*   filebeat.yml            logs/    modules.d/
```

## ì„¤ì •

Filebeatë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— ëª‡ ê°€ì§€ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤. ì„¤ì •ì€ `filebeat.yml` íŒŒì¼ì„ ì´ìš©í•œë‹¤. ë§Œì•½ ì˜ˆì‹œë¥¼ ë³´ê³  ì‹¶ë‹¤ë©´ `filebeat.reference.yml`ì„ ì°¸ê³ í•˜ë©´ ëœë‹¤.

í¬ê²Œ

1. ë¡œê·¸ë¥¼ ë³´ë‚¼ ìœ„ì¹˜ (Output)
2. ëŒ€ì‹œë³´ë“œ ì‚¬ìš©ì„ ìœ„í•œ Kibana ì—”ë“œ í¬ì¸íŠ¸ ì—°ê²°
3. ìˆ˜ì§‘í•  ë¡œê·¸ì˜ ìœ„ì¹˜ (Input)

ì„(ë¥¼) ì„¤ì •í•œë‹¤.

### ë¡œê·¸ë¥¼ ë³´ë‚¼ ìœ„ì¹˜

ë‚˜ëŠ” Logstashë¥¼ ê±°ì¹˜ì§€ ì•Šê³  Elasticsearchì— ë°”ë¡œ ë³´ë‚¼ ê²ƒì´ë¯€ë¡œ Elasticsearchì˜ ì£¼ì†Œë¥¼ ì…ë ¥í•œë‹¤.

```yaml
# ============================== Outputs ===============================

# ----------------------- Elasticsearch Output ----------------------- 
output.elasticsearch: 
  # Array of hosts to connect to. 
  hosts: ["10.0.0.85:9200"] 
  # Protocol - either `http` (default) or `https`. 
```

### Kibana ì—°ê²°

Kibanaì˜ í˜¸ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•˜ë©´ ë¯¸ë¦¬ êµ¬ì¶•ëœ Kibana ëŒ€ì‹œë³´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```yaml
# =============================== Kibana =============================== 
setup.kibana: 
  host: "10.0.0.85:5601"
  
```

### ìˆ˜ì§‘í•  ë¡œê·¸ì˜ ìœ„ì¹˜

ìˆ˜ì§‘í•˜ê³  ì‹¶ì€ ë¡œê·¸ íŒŒì¼ì˜ ìœ„ì¹˜ë¥¼ ì‘ì„±í•œë‹¤. ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¡œê·¸ëŠ” `.json` í˜•ì‹ìœ¼ë¡œ ì €ì¥í•˜ê³  ìˆë‹¤. FilebeatëŠ” í•´ë‹¹ í˜•ì‹ì˜ êµ¬ë¬¸ ë¶„ì„ì„ [ì§€ì›í•œë‹¤](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-input-log.html#filebeat-input-log-config-json).

```yaml
# ========================== Filebeat inputs ==========================
filebeat.inputs: 
[...]
- type: log 
  enabled: true  # ë¡œê·¸ íŒŒì¼ ê²€ìƒ‰ í™œì„±í™”
  paths: 
    - /home/monitorapp/go/src/ucc/uvm/logs/uvm_server_log.json 
  json.keys_under_root: true 
  json.overwrite_keys: true 
  json.add_error_key: true 
  json.expand_keys: true
```


> ğŸ’¡ `json.*`: JSON êµ¬ë¬¸ ë¶„ì„ ì‹œ ì‚¬ìš©í•˜ëŠ” ì˜µì…˜
>
> ì˜ˆì‹œê°€ ìˆìœ¼ë©´ ì´í•´í•˜ê¸° ì¢‹ì€ ì˜µì…˜ë“¤ì— ëŒ€í•œ ì„¤ëª…ì´ë‹¤.
>
> - `keys_under_root` : ê¸°ë³¸ì ìœ¼ë¡œ ë””ì½”ë”©ëœ JSON êµ¬ë¬¸ì€ "json" í•„ë“œ ì•„ë˜ì— ìœ„ì¹˜í•œë‹¤. ì´ ì˜µì…˜ì„ í™œì„±í™”(true)í•˜ë©´ êµ¬ë¬¸ì„ ìµœìƒìœ„ë¡œ ëŒì–´ì˜¬ë¦°ë‹¤.
>
>   ```json
>   {
>       "type": "test_type",
>       "json": {
>           "type": "log",
>           "text": "hello",
>       }
>   }
>   ```
>
>   to
>   
>   ```json
>   {
>       "type": "test_type",
>       "text": "hello",
>   }
>   ```
>
> - `overwrite_keys`: `keys_under_root` ì˜µì…˜ì´ í™œì„±í™”ëœ ìƒíƒœì—ì„œ ì´ ì˜µì…˜ì„ í™œì„±í™”í•˜ë©´ "json" í•„ë“œ ì•„ë˜ ìˆë˜ êµ¬ë¬¸ì˜ í•„ë“œê°€ ê¸°ì¡´ì— ìµœìƒìœ„ì— ìˆë˜ í•„ë“œì™€ ê²¹ì¹  ê²½ìš°, êµ¬ë¬¸ì˜ ê°’ì´ ê¸°ì¡´ ê°’ì„ ë®ì–´ì“´ë‹¤.
>
>   ```json
>   {
>       "type": "log",
>       "text": "hello",
>   }
>   ```

## ì´ˆê¸° í™˜ê²½ ì„¤ì •

```shell
./filebeat setup -e
```

FilebeatëŠ” Elasticsearchë¡œ ìƒ‰ì¸ ì‹œ ê¶Œì¥ë˜ëŠ” ì¸ë±ìŠ¤ êµ¬ì„±ì„ ë‹´ì€ ê¸°ë³¸ [ì¸ë±ìŠ¤ í…œí”Œë¦¿(Index template)](https://www.elastic.co/guide/en/elasticsearch/reference/7.12/index-templates.html), [ì¸ë±ìŠ¤ ìˆ˜ëª… ì£¼ê¸° ê´€ë¦¬(ILM)](https://www.elastic.co/guide/en/elasticsearch/reference/current/overview-index-lifecycle-management.html) ì •ì±…, Kibana ëŒ€ì‹œë³´ë“œ (í™œì„±í™”í–ˆì„ ê²½ìš°) ë“±ì„ ë¶ˆëŸ¬ì™€ ì„¤ì •í•œë‹¤.

ì´ ë¶€ë¶„ì€ ê°ê°ì˜ ê°œë…ì´ ë‚¯ì„¤ì–´ì„œ ì¶”í›„ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ë”°ë¡œ ê¸€ì„ ë³´ì¶©í•´ì•¼ í•  ë“¯í•˜ë‹¤.

## ì‹¤í–‰

ì„¤ì •ì´ ëë‚¬ë‹¤ë©´ Filebeatë¥¼ ì‹¤í–‰í•œë‹¤. 

Elasticì€ Filebeatì˜ [ì´ë²¤íŠ¸ ë°œí–‰ ê¶Œí•œ](https://www.elastic.co/guide/en/beats/filebeat/7.12/privileges-to-publish-events.html)ì„ ìµœì†Œí™”í•  ê²ƒì„ ê¶Œì¥í•œë‹¤. ì„¤ì • íŒŒì¼(`filebeat.yml`)ì˜ ì†Œìœ ê¶Œ ë° ì‹¤í–‰ íŒŒì¼(`filebeat`)ì˜ ì‹¤í–‰ì€ í•´ë‹¹ í˜¸ìŠ¤íŠ¸ì— ë¡œê·¸ì¸ í•œ ìœ ì € í˜¹ì€ `root`ë¡œ ì„¤ì • ë° ì‹¤í–‰í•œë‹¤.

```shell
sudo chown root filebeat.yml
sudo ./filebeat run &
```

Filebeatì˜ ì‹¤í–‰ `logs` ë””ë ‰í„°ë¦¬ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```shell
$ sudo tree logs/
logs/
â”œâ”€â”€ filebeat  
â””â”€â”€ filebeat.1
```

## ğŸ‘©â€ğŸ¨ Kibanaì—ì„œ í™•ì¸

ìˆ˜ì§‘í•œ ë°ì´í„°ë¥¼ Kibanaì—ì„œ í™•ì¸í•´ ë³¼ ì°¨ë¡€ë‹¤. ë¸Œë¼ìš°ì €ë¥¼ ì¼œê³  ì„¤ì •í•œ Kibana ì£¼ì†Œë¡œ ì ‘ì†í•œë‹¤.

### 1#

ì²« í˜ì´ì§€ì—ì„œ `Kibana` > `Discover` ìˆœìœ¼ë¡œ ë“¤ì–´ê°€ë©´ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![kibana3](./kibana3.png)



KibanaëŠ” Elasticsearchì— ì ‘ê·¼í•´ ì‚¬ì „ì— ì„¤ì •ëœ `filebeat-*` ì¸ë±ìŠ¤ íŒ¨í„´ìœ¼ë¡œ ì €ì¥ëœ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ ê²ƒì´ë‹¤.

![kibana4](./kibana4.png)

### 2#

ì²˜ìŒ í˜ì´ì§€ì—ì„œ `Observability` > `Logs` ë©”ë‰´ì—ì„œë„ ë¡œê·¸ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 

![kibana9](./kibana9.png)

![kibana11](./kibana11.png)

## ê²°ë¡ 

Filebeatë¥¼ ì„¤ì¹˜í•˜ì—¬ ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì €ì¥í•˜ê³ , ìµœì¢…ì ìœ¼ë¡œ Kibanaì—ì„œ í•´ë‹¹ ë°ì´í„°ë¥¼ í™•ì¸í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ë‹¤. ì´í›„ ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•˜ë©° ì´ìŠˆê°€ ë°œìƒí•˜ë©´, Kibanaë¥¼ ì´ìš©í•´ ì´ìŠˆì˜ ì›ì¸ì´ ë  ë§Œí•œ ë¡œê·¸ë¥¼ í¸ë¦¬í•˜ê²Œ ê²€ìƒ‰í•  ìˆ˜ ìˆë‹¤. 

ì¶”í›„ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” ëŒ€ì‹œë³´ë“œ êµ¬ì„±ì„ í†µí•´ ë¡œê·¸ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ì—¬ íš¨ê³¼ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ë„ ìˆë‹¤.

ë‹¤ìŒ ê¸€ì—ì„œëŠ” Filebeatê°€ ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ê³¼ ê·¸ êµ¬ì¡°ì— ëŒ€í•´ ì•Œì•„ë³´ì.

---

## ğŸ“œì°¸ê³ 

- [What are Beats? | Beats Platform Reference [7.12] | Elastic(Website. 2021.04.23)](https://www.elastic.co/guide/en/beats/libbeat/current/beats-reference.html)
- Filebeat Reference [7.12] | Elastic(Website)
  - [Filebeat overview(2021.04.23)](https://www.elastic.co/guide/en/beats/filebeat/7.12/filebeat-overview.html)
  - [Filebeat quick start: installation and configuration(2021.04.23)](https://www.elastic.co/guide/en/beats/filebeat/7.12/filebeat-installation-configuration.html)
  - [Modules overview(2021.04.25)](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules-overview.html)
  - [Filebeat command reference(2021.04.26)](https://www.elastic.co/guide/en/beats/filebeat/current/command-line-options.html#setup-command)
  - [Grant privileges and roles needed for publishing(2021.04.26)](https://www.elastic.co/guide/en/beats/filebeat/7.12/privileges-to-publish-events.html)
  - [Log input(2021.04.27)](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-input-log.html#filebeat-input-log-config-json)
- Elasticsearch Guide [7.12] | Elastic(Website)
  - [Index templates(2021.04.26)](https://www.elastic.co/guide/en/elasticsearch/reference/7.12/index-templates.html)
  - [ILM overview(2021.04.26)](https://www.elastic.co/guide/en/elasticsearch/reference/current/overview-index-lifecycle-management.html)
