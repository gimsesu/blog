---
title: ğŸ‘¨â€ğŸ­ Elasticsearchì—ì„œ Tokenizerë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•´ë³´ì 
date: 2021-04-05
slug: "/elasticsearch-customize-tokenizer"
description: Elasticsearchì—ì„œ Text Analyzer - N-Gram Tokenizerë¥¼ ì ìš©í–ˆë˜ ê²½í—˜ì„ ê³µìœ í•©ë‹ˆë‹¤.
tags:
  - Elasticsearcch
---

ë‚˜ëŠ” ì‚¬ë‚´ì—ì„œ URL ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” í”„ë¡œì íŠ¸ë¥¼ ë§¡ê³  ìˆì—ˆë‹¤. ë°ì´í„°ì˜ ë¹ ë¥¸ ê²€ìƒ‰ì„ ìœ„í•´ Elasticsearchë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì•˜ëŠ”ë°, íŠ¹ì • í‚¤ì›Œë“œë¡œ URLì„ ê²€ìƒ‰í•˜ê³  ì‹¶ì€ë° ì˜ ì•ˆ ë˜ëŠ” ê²ƒì„ ë°œê²¬í–ˆë‹¤.


##  ğŸ§° ì¤€ë¹„ë¬¼ 


- Elasticsearch v7.x


## ì™œ ê²€ìƒ‰ì´ ì•ˆ ë˜ì£ ?

ë‚´ Elasticsearch ì¸ë±ìŠ¤ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ URL ë°ì´í„°ê°€ ì €ì¥ë¼ ìˆë‹¤.

```text
https://tk.welldnn.com/
```

ê²€ìƒ‰í•  ë•Œ root domainì„ ê¸°ì¤€ìœ¼ë¡œ ê²€ìƒ‰ì„ í•œë‹¤ê³  ê°€ì •í•˜ê³ , 'welldnn' í˜¹ì€ 'welldnn.com'ìœ¼ë¡œ ê¸°ë³¸ì ì¸ ì „ë¬¸ ê²€ìƒ‰(Full text query)ì„ í–ˆë‹¤.


```shell
GET /_search
{
  "query": {
    "match": {
      "message": {
        "query": "welldnn"
      }
    }
  }
}
```

ìœ„ì˜ ì¿¼ë¦¬ì™€ ê°™ì´ ê²€ìƒ‰í–ˆì„ ë•Œ, ì¼ì¹˜í•˜ëŠ” ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì—ˆë‹¤. Elasticsearchì—ì„œ ê²€ìƒ‰í•˜ë©´ ì¼ë¶€ í‚¤ì›Œë“œë¡œë„ ê²€ìƒ‰í•  ìˆ˜ ìˆë‹¤ê³  ì•Œê³  ìˆì—ˆëŠ”ë°, ì–´ë””ì„œë¶€í„° ì˜ëª»ëœ ê±¸ê¹Œ?

## í…ìŠ¤íŠ¸ ë¶„ì„

í•´ë‹¹ ê²€ìƒ‰ì˜ ì›ì¸ì„ ì•Œê¸° ìœ„í•´ì„œëŠ” Elasticsearchê°€ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ì €ì¥í•˜ëŠ”ì§€ë¥¼ ì•Œì•„ì•¼ í•œë‹¤.


ElasticsearchëŠ” í…ìŠ¤íŠ¸ë¥¼ ì €ì¥í•  ë•Œ '[í…ìŠ¤íŠ¸ ë¶„ì„(Tesxt Analysis)](https://esbook.kimjmin.net/06-text-analysis/6.2-text-analysis)'ì„ ìˆ˜í–‰í•œë‹¤. ì´ë¥¼ í†µí•´ íŠ¹ìœ ì˜ '[ì—­ ìƒ‰ì¸(Inverted index)](https://www.slideshare.net/kjmorc/ss-80803233)' êµ¬ì¡°ë¥¼ í˜•ì„±í•œë‹¤.

### ë¶„ì„ê¸°

í•´ë‹¹ ê³¼ì •ì€ '[ë¶„ì„ê¸°(Analyzer)](https://www.elastic.co/guide/en/elasticsearch/reference/current/analyzer-anatomy.html#analyzer-anatomy)'ê°€ ìˆ˜í–‰í•œë‹¤. ë¶„ì„ê¸°ëŠ” í¬ê²Œ ë¬¸ì í•„í„°(Character filters)ì™€ í† í¬ë‚˜ì´ì €(Tokenizer), í† í° í•„í„°(Token filter)ë¡œ êµ¬ì„±ë¼ ìˆë‹¤. ê° ìš”ì†ŒëŠ” ê°œë³„ì ìœ¼ë¡œ ì‚¬ìš©ì ì§€ì •ì´ ê°€ëŠ¥í•˜ë©°, ì´ë“¤ì´ ëª¨ì—¬ ë‹¤ì–‘í•œ ì–¸ì–´ ë° í…ìŠ¤íŠ¸ ìœ í˜•ì— ì í•©í•œ ë¶„ì„ê¸°ë¥¼ êµ¬ì„±í•œë‹¤. 

### í† í°í™”

ì—¬ê¸°ì„œ ëˆˆì—¬ê²¨ë³´ì•„ì•¼ í•  ë¶€ë¶„ì€ í† í¬ë‚˜ì´ì €ë‹¤. [í† í¬ë‚˜ì´ì €(Tokenizer)](https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenizers.html)ëŠ” ì…ë ¥ëœ í…ìŠ¤íŠ¸ë¥¼ 'í† í°'ì´ë¼ê³  í•˜ëŠ” ê°œë³„ ë‹¨ì–´ë“¤ë¡œ ë¶„í• í•œë‹¤. ì´ ì‘ì—…ì„ í† í°í™”(Tokenization)ë¼ê³  í•œë‹¤. ì´ ê³¼ì •ì„ í†µí•´ ì‚¬ìš©ìëŠ” êµ¬ë¬¸ì— í¬í•¨ëœ ì¼ë¶€ ë‹¨ì–´ë§Œ ì…ë ¥í•´ë„ êµ¬ë¬¸ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ” ì „ë¬¸ ê²€ìƒ‰ì´ ê°€ëŠ¥í•˜ê²Œ ëœë‹¤.

ElasticsearchëŠ” ê¸°ë³¸ì ìœ¼ë¡œ [í‘œì¤€ ë¶„ì„ê¸°(Standard analyzer)](https://www.elastic.co/guide/en/elasticsearch/reference/master/analysis-standard-analyzer.html)ë¥¼ ì œê³µí•˜ë©°, ê·¸ ì•ˆì—ëŠ” [í‘œì¤€ í† í¬ë‚˜ì´ì €(Standard tokenizer)](https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-standard-tokenizer.html)ê°€ ìˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì€ í…ìŠ¤íŠ¸ë¥¼ ì €ì¥í•˜ëŠ” ê²½ìš°,

```text
"The 2 QUICK Brown-Foxes jumped.over the lazy dog's bone."
```

 í‘œì¤€ í† í¬ë‚˜ì´ì €ëŠ” ì•„ë˜ì™€ ê°™ì´ í† í°í™”í•œë‹¤. í‘œì¤€ í† í¬ë‚˜ì´ì €ì˜ ë¶„í•  ê¸°ì¤€ì€ í¬ê²Œ ê³µë°±(Whitespace) ë° "@"ê³¼ ê°™ì€ ì¼ë¶€ íŠ¹ìˆ˜ë¬¸ìë‹¤. 

```shell
[ The, 2, Quick, Brown, Foxes, jumped.over, the, lazy, dog's, bone ]
```

ë¶„ì ˆëœ ë‹¨ì–´ë“¤ì€ ëª¨ë‘ ì €ì¥ëœ í…ìŠ¤íŠ¸ë¥¼ ê°€ë¦¬í‚¨ë‹¤. ê·¸ë˜ì„œ ì‚¬ìš©ìëŠ” 'Quick'ì´ë‚˜ 'lazy'ë¥¼ ì…ë ¥í•˜ë©´ ìœ„ì˜ ë¬¸ì¥ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

ì´ ê·œì¹™ì„ ì‚´í´ë³´ë‹ˆ ë‚´ê°€ ì €ì¥í–ˆë˜ ë°ì´í„°ëŠ” ì™œ ê²€ìƒ‰ì´ ì•ˆ ëëŠ”ì§€ ì§ì‘ì´ ê°„ë‹¤. ë‚´ê°€ ì €ì¥í–ˆë˜ URLì€ ì–´ë–»ê²Œ í† í°í™”ê°€ ë˜ì–´ ìˆëŠ”ì§€ ì‚´í´ë³´ì.


```shell
GET _analyze?pretty
{ 
  "field": "my_field",  
  "text": "https://tk.welldnn.com/" 
}
```


"https", "tk.welldnn.com" ë‹¨ ë‘ ê°œì˜ í† í°ìœ¼ë¡œë§Œ ë¶„í• ë˜ì–´ ìˆë‹¤.


```shell
{
	"tokens" : [
		{
			"token" : "https",
			"start_offset" : 0,
			"end_offset" : 5,
			"type" : "<ALPHANUM>",
			"position" : 0,	
		},
		{
			"token" : "tk.welldnn.com",
			"start_offset" : 22,
			"end_offset" : 8,
			"type" : "<ALPHANUM>",
			"position" : 1
		}
	]
}
```

í‘œì¤€ í† í¬ë‚˜ì´ì €ê°€ `://`ëŠ” êµ¬ë¶„ìë¡œ ì¸ì‹í–ˆì§€ë§Œ, `.`ì€ ê·¸ë ‡ì§€ ì•Šì•˜ë‹¤. ê·¸ë˜ì„œ 'welldnn.com'ìœ¼ë¡œ ê²€ìƒ‰í•˜ë©´ ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šì•˜ë˜ ê²ƒì´ë‹¤.


## í† í¬ë‚˜ì´ì € ì‚¬ìš©ì ì§€ì •

ì•ì„œ ë§í–ˆë“¯ í† í¬ë‚˜ì´ì €ëŠ” ì‚¬ìš©ì ì§€ì •ì´ ê°€ëŠ¥í•˜ë‹¤. ë‚´ê°€ ì›í•˜ëŠ” ê·œì¹™ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì ˆí•˜ì—¬ 'wellldnn'ì´ë‚˜ 'welldnn.com'ì„ ì…ë ¥í•˜ë©´ ê²€ìƒ‰ì´ ë˜ë„ë¡ í•´ë³´ì. ë‹¤í–‰íˆ ElasticsearchëŠ” ë‚´ì¥ í† í¬ë‚˜ì´ì €ë“¤ì„ í†µí•´ ë‹¤ì–‘í•œ ë¶„ì ˆ ê·œì¹™ì„ ì œê³µí•œë‹¤.

### N-gram Tokenizer

[N-gram tokenizer](https://www.elastic.co/guide/en/elasticsearch/reference/master/analysis-ngram-tokenizer.html)ëŠ” ì…ë ¥ëœ ë¬¸ìì—´ ì¤‘ í•˜ë‚˜ì˜ ë¬¸ìê°€ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ ì§€ì •ëœ ê¸¸ì´ì˜ N-gramì„ ì¶œë ¥í•œë‹¤. ê³µë°±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì–¸ì–´ë“¤ì„ ë‹¤ë£° ë•Œ ìœ ìš©í•˜ë‹¤.


ê¸°ë³¸ ngram tokenizerëŠ” í…ìŠ¤íŠ¸ë¥¼ ìµœì†Œ ê¸¸ì´ 1ì—ì„œ ìµœëŒ€ ê¸¸ì´ 2ì˜ N-gramìœ¼ë¡œ ë¶„í• í•œë‹¤.


```shell
POST _analyze
{
  "tokenizer": "ngram",
  "text": "Quick Fox"
}

# ì‘ë‹µ
[ Q, Qu, u, ui, i, ic, c, ck, k, "k ", " ", " F", F, Fo, o, ox, x ]
```

ê³µë°± ê´€ê³„ì—†ì´ ë¬¸ìì—´ì„ íŠ¹ì • ê¸¸ì´ì— ë”°ë¼ ë‹¤ì–‘í•˜ê²Œ ë¶„ë¦¬ë¥¼ í•´ì£¼ëŠ” ê²ƒì„ í™•ì¸í•˜ë‹ˆ URLì„ ë¶„ì„í•˜ê³  ê²€ìƒ‰í•˜ëŠ” ë° íš¨ê³¼ì ì¸ ë°©ë²•ì´ë¼ëŠ” ê²ƒì„ ì•Œê² ë‹¤. ì´ì œ ë‚´ ì¸ë±ìŠ¤ì— ì„¤ì •í•˜ê³  í…ŒìŠ¤íŠ¸í•´ë³´ì.

URLì˜ ê²½ìš° ìµœì†Œ 2 ê¸€ìë¡œ ê²€ìƒ‰ì„ í•´ì•¼í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. (e.g. `http://www.lm.co.kr/`) ìµœì†Œ 2 ê¸€ì, ìµœëŒ€ 30 ê¸€ìë¡œ gramì˜ ë‹¨ìœ„ë¥¼ ì„¤ì •í•œë‹¤. í† í°ì— í¬í•¨í•  ë¬¸ì ìœ í˜•(`token_chars`)ìœ¼ë¡œëŠ” ì¼ë°˜ ë¬¸ì(`letter`), ìˆ«ì(`digit`), [êµ¬ë‘ì ](https://www.thepunctuationguide.com/)(`punctuation`)ìœ¼ë¡œ ì„¤ì •í–ˆë‹¤.

>ğŸ’¡ ì„¸ë¶€ ì„¤ì •ì— ëŒ€í•œ ìì„¸í•œ ì‚¬í•­ì€ [ì—¬ê¸°ì„œ](https://www.elastic.co/guide/en/elasticsearch/reference/master/analysis-ngram-tokenizer.html#_configuration_14) í™•ì¸í•  ìˆ˜ ìˆë‹¤.



```json
PUT my-index-url
{
  "settings": {
    "analysis": {
			"analyzer": {
				"my_analyzer": {
					"tokenizer": "my_tokenizer"
				}
			},
			"tokenizer": {
				"my_tokenizer": {
					"type": "ngram",
					"min_gram": 2,
					"max_gram": 30,
					"token_chars": [
						"letter",
						"digit",
						"punctuation"
					]
				}
			}
		}
	}
}
```


ì„¤ì •í•œ ë¶„ì„ê¸°ë¥¼ ì´ìš©í•´ ë‚´ê°€ ê²€ìƒ‰í•  URLì˜ ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì.

ë¶„í• ë˜ëŠ” N-gramì˜ ìˆ˜ê°€ ë§ì•„ ëª‡ëª‡ êµ¬ê°„ì€ ìƒëµí–ˆë‹¤. ì„¤ì •ëŒ€ë¡œ ìµœì†Œ 2ê¸¸ì´ë¶€í„° í† í°ì´ ìƒì„±ë¼ ìˆë‹¤. 'welldnn'ê³¼ 'welldnn.com'ì´ í† í°ìœ¼ë¡œ ë“¤ì–´ ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.


```shell
POST my-index-url/_analyze
{
  "analyzer": "my_analyzer",
  "text": "https://tk.welldnn.com/"
}

# ì‘ë‹µ
[ ht, htt, (...), welldn, welldnn, welldnn., (...), welldnn.com, (...) ]
```


## Mapping

ì‚¬ìš©ì ì§€ì •í•œ ë¶„ì„ê¸°ë¥¼ ì´ìš©í•˜ë ¤ë©´ í•´ë‹¹ í•„ë“œì— ì§ì ‘ ì ìš©í•´ì¤˜ì•¼ í•œë‹¤. ì´ ê³¼ì •ì„ [ë§¤í•‘(Mapping)](https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html)ì´ë¼ê³  í•œë‹¤. 

```shell
PUT /my-index-url
{
	"mappings": {
		"properties": {
			"my_field": {
				"type": "text",
				"analyzer": "my_analyzer"
			}
		}
	}
}`
```

ë§¤í•‘ì„ ì™„ë£Œí–ˆë‹¤ë©´ `my_field`ì— ë°ì´í„° 'https://welldnn.com/'ì„ ë‹¤ì‹œ ì €ì¥í•˜ê³ , ê²€ìƒ‰ì„ ì§„í–‰í•´ë³´ì.


## ë‹¤ì‹œ ê²€ìƒ‰

```shell
GET /_search
{
  "query": {
    "bool": {
      "must": {
      	"term": {
      		"my_field.ngram": "welldnn"
      	}
      }
    }
  }
}
```

>ğŸ’¡ `bool` - `must`: ì¿¼ë¦¬ì— ì¼ì¹˜í•˜ëŠ” ê²°ê³¼ë¬¼ì„ ëª¨ë‘ ë°˜í™˜


>ğŸ’¡ `term`: ì…ë ¥ëœ ê²€ìƒ‰ì–´ë¥¼ ì •í™•í•˜ê²Œ í¬í•¨í•˜ëŠ” ë¬¸ì„œë¥¼ ë°˜í™˜


ì•„ë˜ì™€ ê°™ì´ ì •ìƒì ìœ¼ë¡œ ì˜ë„í•œ URLì´ ì €ì¥ëœ ë¬¸ì„œë¥¼ ë°˜í™˜í•œë‹¤. 'welldnn.com'ìœ¼ë¡œ í–ˆì„ ë•Œì—ë„ ë™ì¼í•œ ê²°ê³¼ë¥¼ ì–»ì—ˆë‹¤.


```shell
{ 
  "took" : 43, 
  "timed_out" : false, 
  "_shards" : { 
    "total" : 1, 
    "successful" : 1, 
    "skipped" : 0, 
    "failed" : 0 
  }, 
  "hits" : { 
    "total" : { 
      "value" : 1, 
      "relation" : "eq" 
    }, 
    "max_score" : 1.0, 
    "hits" : [ 
      { 
        "_index" : "my-indxe-url", 
        "_type" : "_doc", 
        "_id" : "YKolMHUBBpbv40eG180S", 
        "_score" : 1.0, 
        "_source" : { 
          "my_field" : "https://tk.welldnn.com/" 
        } 
      } 
    ] 
  } 
}
```

## ê²°ë¡ 

ì‹¤ì œë¡œ í•´ë‹¹ ì„¤ì •ë“¤ì„ ì ìš©í•  ë• ì˜ ëª°ëëŠ”ë°, ê¸€ì„ ì“°ë©´ì„œ Elasticsearchì— ì €ì¥í•˜ëŠ” í…ìŠ¤íŠ¸ ë°ì´í„°ë“¤ì´ ì–´ë–¤ ì›ë¦¬ë¡œ ì €ì¥ë˜ê³  ê´€ë¦¬ë˜ëŠ”ì§€ ìì„¸íˆ ì•Œ ìˆ˜ ìˆì—ˆë‹¤. 

---



## ğŸ“œ ì°¸ê³ 

- [ë„ë©”ì¸ ì´ë¦„ì˜ êµ¬ì¡° - ìƒí™œì½”ë”©. (Website. 2021.04.05)](https://opentutorials.org/course/3276/20303)

- [á„€á…¥á†·á„‰á…¢á†¨á„‹á…¦á†«á„Œá…µá†«á„‹á…µ á„ƒá…¦á„‹á…µá„á…¥á„…á…³á†¯ á„ƒá…¡á„…á…®á„‚á…³á†« á„‡á…¥á†¸ á„€á…µá†·á„Œá…©á†¼á„†á…µá†«. (Website. 2021.04.05)](https://www.slideshare.net/kjmorc/ss-80803233)


- Elasticsearch Guide [7.12] | Elastic. (Website. 2021.04.05)
  - [Match query](https://www.elastic.co/guide/en/elasticsearch/reference/7.11/query-dsl-match-query.html#query-dsl-match-query)
  - [Text analysis](https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html)
  - [Anatomy of an analyzer](https://www.elastic.co/guide/en/elasticsearch/reference/current/analyzer-anatomy.html#analyzer-anatomy)
  - [Tokenizer](https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenizers.html)
  - [Standard analyzer](https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-standard-analyzer.html)
  - [Standard tokenizer](https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-standard-tokenizer.html#analysis-standard-tokenizer)
  - [Mapping](https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html)
  - [Explicit mapping](https://www.elastic.co/guide/en/elasticsearch/reference/current/explicit-mapping.html)
- Elasticsearch Guide [master] | Elastic. (Website. 2021.04.05)
  - [N-gram tokenizer](https://www.elastic.co/guide/en/elasticsearch/reference/master/analysis-ngram-tokenizer.html)
  - [Term query](https://www.elastic.co/guide/en/elasticsearch/reference/master/query-dsl-term-query.html#query-dsl-term-query)

- [í…ìŠ¤íŠ¸ ë¶„ì„ - Text Analysis - Elastic ê°€ì´ë“œë¶. (Website. 2021.04.05)](https://esbook.kimjmin.net/06-text-analysis/6.2-text-analysis)